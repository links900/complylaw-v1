<!-- templates/429.html -->
{% extends "base.html" %}
{% block title %}Rate Limited - ComplyLaw{% endblock %}

{% block content %}
<div class="max-w-md mx-auto py-16 text-center">
    <h1 class="text-6xl font-bold text-red-600">429</h1>
    <p class="text-xl text-gray-700 mt-4">Too Many Requests</p>
    <p class="text-gray-600 mt-2">You can only run 3 scans per minute. Please wait and try again.</p>
    <a href="{% url 'scanner:scan_list' %}" class="mt-6 inline-block bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">
        Back to Scans
    </a>
</div>
{% endblock %}

{% block scripts %}
<script>
document.body.addEventListener('htmx:afterOnLoad', function(evt) {
    if (evt.detail.xhr.status === 429) {
        const msg = "Too many scans. Please wait 1 hour.";

        const rateLimitDiv = document.getElementById('rate-limit-msg');
        if (rateLimitDiv) {
            rateLimitDiv.innerHTML = `<span class="text-red-600">${msg}</span>`;
        }

        const toast = document.createElement('div');
        toast.innerText = msg;
        toast.className = 'fixed bottom-4 right-4 px-6 py-3 bg-red-600 text-white rounded-lg shadow-lg z-50';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 4000);

        setTimeout(() => {
            const modal = document.getElementById('scanModal');
            if (modal) modal.remove();
        }, 500);
    }
});
</script>
{% endblock %}
